!function($){var BSImagify=function($ele,settings){this.$ele=$ele,this.settings=settings,this.formater=new BSImagifyFormater(this.$ele,this.settings),this.fitter=new BSImagifyFitter(this.$ele,this.settings),this.imageLoaded=imagesLoaded(this.$ele),this.addEventHandlers(),this.hideImages()};BSImagify.prototype.addEventHandlers=function(){var self=this;this.imageLoaded.on("done",function(){self.formater.setImageFormat(),self.fitter.setImageFit(),self.showImages()});var didResize=!1;$(window).resize(function(){didResize=!0}),setInterval(function(){didResize&&(didResize=!1,self.formater.setImageFormat(),self.fitter.setImageFit())},250)},BSImagify.prototype.hideImages=function(){this.$ele.css({opacity:0})},BSImagify.prototype.showImages=function(){this.$ele.fadeTo(900,1)};var BSImagifyFormater=function($wrapper,settings){this.$wrapper=$wrapper,this.settings=settings,this.ratio=this.getRatio()};BSImagifyFormater.prototype.setImageFormat=function(){var widthRatio=this.$wrapper.width()/this.ratio.width,heightRatio=widthRatio*this.ratio.height;this.$wrapper.height(heightRatio)},BSImagifyFormater.prototype.getRatio=function(){var ratioStr=this._getRatioString();return this._getRatioFromString(ratioStr)},BSImagifyFormater.prototype._getRatioString=function(){switch(this.settings.format){case"square":return"1:1";case"landscape":return this.settings.landscapeRatio;case"portrait":return this.settings.portraitRatio;default:return this.settings.ratio}},BSImagifyFormater.prototype._getRatioFromString=function(ratioStr){var ratioArr=ratioStr.split(":");return{width:ratioArr[0],height:ratioArr[1]}};var BSImagifyFitter=function($wrapper,settings){this.$wrapper=$wrapper,this.$image=this.$wrapper.find("img"),this.settings=settings,this._resetImageCSS()};BSImagifyFitter.prototype.setImageFit=function(){switch(this.settings.fit){case"crop":this._cropImage();break;case"scale":this._scaleImage()}},BSImagifyFitter.prototype._cropImage=function(){this.$image.width()>this.$image.height()?this._fitHorizontal():this._fitVertical(),this._alignImage()},BSImagifyFitter.prototype._scaleImage=function(){this.$image.width()>this.$image.height()?this._fitVertical():this._fitHorizontal(),this._alignImage()},BSImagifyFitter.prototype._fitHorizontal=function(){this._getNaturalHeight(this.$image)>=this.$wrapper.height()&&this.$image.height(this.$wrapper.height())},BSImagifyFitter.prototype._fitVertical=function(){this._getNaturalWidth(this.$image)>=this.$wrapper.width()&&this.$image.width(this.$wrapper.width())},BSImagifyFitter.prototype._alignImage=function(){var style={};switch(style.marginLeft=(this.$wrapper.width()-this.$image.width())/2,this.settings.align){case"top":break;case"middle":style.marginTop=(this.$wrapper.height()-this.$image.height())/2;break;case"bottom":style.marginTop=this.$wrapper.height()-this.$image.height()}this.$image.css(style)},BSImagifyFitter.prototype._getNaturalHeight=function($image){return $image.prop("naturalHeight")?$image.prop("naturalHeight"):this._getNaturalSize($image).height},BSImagifyFitter.prototype._getNaturalWidth=function($image){return $image.prop("naturalWidth")?$image.prop("naturalWidth"):this._getNaturalSize($image).width},BSImagifyFitter.prototype._getNaturalSize=function($image){var img=new Image;return img.src=$image.prop("src"),{width:img.width,height:img.height}},BSImagifyFitter.prototype._resetImageCSS=function(){this.$image.css({maxWidth:"none"})},$.fn.bs_imagify=function(options){var settings=$.extend({},$.fn.bs_imagify.defaults,options);return this.each(function(){var $ele=$(this);$ele.data("_bs_imagify",new BSImagify($ele,settings))})},$.fn.bs_imagify.defaults={fit:"crop",ratio:"1:1",format:"ratio",align:"middle",landscapeRatio:"4:3",portraitRatio:"3:4"}}(jQuery);